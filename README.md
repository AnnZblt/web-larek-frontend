# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении


Тип категории
```

type Category = 'другое' | 'хард-скил' | 'кнопка' | 'дополнительное' | 'софт-скил';
```

Данные товара с апи, которые потом используются в карточке
```
interface IGood {
  _id: string;
  title: string;
  price: number;
  category: Category;
  description?: string;
  image: string;
}
```

Товар для корзины
```
type TGoodCompact = Pick<IGood, '_id' | 'title' | 'price'>;
```

Товар для фулвью
```
type TGoodFull = IGood;
```

Интерфейс для самой карточки во вью
```
interface ICard {
  category: string;
  title: string;
  image?: string;
  price: number | null;
  description?: string;
}
```

Данные приложения
```
interface IAppState {
  catalog: IGood[];
  basket: string[];
  order: IOrder | null;
}
```

Форма со способом оплаты и адресом доставки
```
interface IOrderForm {
  payment: string;
  address: string;
}
```

Форма с данными пользователя
```
interface IContactsForm {
  email: string;
  phone: string;
}
```

Сформированный заказ
```
interface IOrder extends IOrderForm, IContactsForm {
  items: string[];
  total: number;
}
```

Валидация ошибок
```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Статус форм
```
interface IFormState {
  valid: boolean;
  errors: string[];
}
```

Cодержимое страницы с возможностью блокирования прокрутки
```
interface IPage {
  catalog: HTMLElement[];
  locked: boolean;
}
```

Содержимое модального окна 
```
interface IModalData {
  content: HTMLElement;
}
```

Изменяемые элементы корзины
```
interface IBasketView {
  items: HTMLElement[];
  total: number;
}
```

Данные для отображения в окне успешной отправки заказа на сервер
```
interface ISuccess {
  total: number;
}
```

Отслеживание событие клика в окне Success 
```
interface ISuccessActions {
  onClick: () => void;
}
```

Интерфейс для отправки заказа на сервер
```
export interface IOrderResult {
  id: string;
}
```


## Описание проекта

Проект "WEB-ларёк" реализует пример типового интернет-магазина, в данном случае товаров для разработчиков. Пользователь может просматривать галерею товаров, выбирать товары и покупать их. Проект реализован на TypeScript и представляет собой SPA (Single Page Application) с использованием API для получения данных о товарах.


## Описание интерфейса

Интерфейс можно условно разделить на 3 процесса:

  1. Просмотр галереи товаров (page)
  2. Просмотр конкретного товара и добавление его в корзину (Preview)
  3. Оформление заказа (Basket, Form, Success)


## Архитектура проекта (MVP)

Код приложения разделен на на слои, согласно парадигме MVP: 
  - Слой данных отвечает за работу с данными, бизнес-логику и взаимодействие с хранилищем.
  - Слой представления отображает информацию пользователю и передает события. Он не содержит логики и только вызывает методы презентера.
  - Презентер — посредник между бизнес-логикой и слоем данных (Model и View), получает данные из модели, подготавливает их и передает в View.



### Базовый код

#### Класс Api

Предоставляет базовый функционал для отправки HTTP-запросов. В конструктор передается базовый URL сервера и необязательный объект с заголовками.

Методы: 
  - `get` - выполняет GET-запрос по указанному адресу и возвращает промис с ответом сервера в виде объекта. По умолчанию используется метод GET.
  - `post` - отправляет переданный объект данных в формате JSON на указанный адрес, возвращая результат запроса.

#### Класс EventEmitter

Механизм событийного взаимодействия, который позволяет отправлять и обрабатывать события в системе. Используется в презентере для управления событиями и в других слоях для их генерации.

Основные методы, определенные интерфейсом `IEvents`:
  - `on` - подписывает обработчик на событие.
  - `emit` - инициирует событие.
  - `trigger` - возвращает функцию, вызывающую заданное событие.



### Слой данных

Вся логика, связанная с данными приложения, централизована в одном модуле, что обеспечивает прозрачность архитектуры и облегчает сопровождение проекта.
Класс AppState инкапсулирует состояние корзины, каталога и заказа, а также содержит всю бизнес-логику, связанную с валидацией форм и управлением данными, выступая связующим звеном между моделью и представлением.

Классы AppState и GoodItem расширяют базовый класс Model, предоставляющий механизм генерации событий. Хотя в проекте преимущественно используются явно заданные события через emit, базовая модель остаётся удобной основой для хранения и управления данными. В нескольких ключевых местах применяется метод emitChanges, чтобы уведомлять представление об изменениях, например, при обновлении корзины или каталога.

Поля класса GoodItem:
  - id: string;
  - description?: string;
  - image?: string;
  - title: string;
  - price: number;
  - category: string;
Все шесть строк — это поля класса GoodItem, определяющие структуру объекта товара. Знак ? означает, что поле необязательное (может быть undefined).

Поля класса AppState: 
  - basket: GoodItem[] - данные о товаре в корзине. Хранит массив элементов типа GoodItem.
  - catalog: GoodItem[] - данные о товаре в галерее(каталоге). Хранит массив типа GoodItem.
  - order: IOrder - данные о заказе. Объект типа IOrder собирает данные для дальнейшей отправки на сервер. 
  - formErrors: FormErrors - данные об ошибках валидации. Содержит объект типа FormErrors. 

Методы класса AppState:

  - initBasket(): void  - инициализация корзины. Устанавливает значение корзины как пустое при запуске приложения. Вызывает событие изменения корзины.
  - basketCheck(items: GoodItem[], targetId: string): boolean  - проверяет список товаров на наличие определенного товара. В связке с вью позволяет блокировать кнопки, если товар уже добавлен в корзину.
  - addToBasket(item: GoodItem): void - добавляет товар в список basket, эмитит событие изменения корзины.
  - getItems(): string[] - позволяет получить список идентификаторов добавленных в корзину товаров.
  - removeFromBasket(id: string): void - удаляет товар из списка basket.
  - getTotal(): number - считает сумму товаров в списке basket.
  - clearBasket(): void - очищает корзину и список заказа.
  - setCatalog(items: TGoodFull[]): void - заполняет каталог для дальнейшей отрисовки их на странице.
  - setOrderField(field: keyof IOrderForm, value: string): void - заполняет поля в order из формы с методом оплаты и адресом.
  - setContactsField(field: keyof IContactsForm, value: string): void - заполняет поля в order с контактами пользователя.
  - validateOrderForm(): boolean | number - валидирует форму с методом оплаты и адресом. В случае успешной валидации очищает объект formErrors.
  - validateContactsForm(): boolean | number - валидирует форму с контактами пользователя. В случае успешной валидации очищает объект formErrors.


### Слой представления

Классы отвечают за визуализацию данных.

#### Класс Page

Класс Page представляет корневой компонент пользовательского интерфейса и управляет основными областями страницы: оберткой содержимого, галереей товаров и кнопкой открытия корзины. Базируется на классе Component и реализует его в контексте конкретного компонента интерфейса.

Поля:
  - _wrapper: HTMLElement - все содержимое страницы, включая шапку(header) и основной контент(main). 
  - _basket: HTMLElement - кнопка корзины на главной.
  - _counter: HTMLElement - счетчик товаров в корзине на главной.
  - _gallery: HTMLElement - галерея товаров.

Методы:
  - set counter(value: number) - реализует родительский метод setText для установки счетчика. 
  - set gallery(items: HTMLElement[]) - заполняет галерею товарами.
  - set locked(value: boolean) - позволяет запретить/разрешить прокрутку страницы.

#### Класс Modal

Компонент, отвечающий за отображение модального окна. Имеет контейнер с кнопкой закрытия и областью контента (`.modal__content`), куда вставляется внешний компонент: форма, карточка, корзина и т.п. Базируется на классе Component и реализует его в контексте конкретного компонента интерфейса.

Поля:
  - _closeButton - кнопка закрытия модального окна.
  - _content - контейнер для встраиваемого контента.

Методы:
  - set content(value: HTMLElement) - встраивает переданный в качестве аргумента контент.
  - open():void - открывает модальное окно, инициирует событие modal:open, блокирующее прокрутку страницы.
  - close():void - закрывает модальное окно, инициирует событие modal:close, которое возвращает возможность прокрутки страницы.
  - render(data: IModalData): HTMLElement - реализует метод из родительского класса. В качестве аргумента принимает HTMLElement, возвращает готовое отрисованное модальное окно с содержимым.

#### Встраиваемые компоненты (контент модального окна)

Следующие компоненты не наследуют `Modal`, но могут быть встроены внутрь модального окна через `modal.render({content:...})`:

  - `Basket` — содержимое корзины.
  - `Form` — формы ввода пользовательских данных.
  - `Success` — сообщение об успешной оплате.
  - `Preview` — карточка товара в увеличенном формате.

#### Basket

Basket — это компонент, который отвечает за отображение содержимого корзины пользователя. Он отображает список добавленных товаров, общую стоимость и позволяет оформить заказ. Базируется на классе Component и реализует его в контексте конкретного компонента интерфейса.

Поля:
  - _list: HTMLElement — список товаров.
  - _total: HTMLElement - сумма товаров в корзине.
  - _button: HTMLElement - кнопка оформления заказа и переход к следующему шагу.

Методы:
  - set items(items: HTMLElement[]) - принимает в качества аргумента массив HTML-элементов(li-элементов списка) для дальнейшего отображения их в list. Реализует родительский метод setDisabled, который блокирует/разблокирует кнопку перехода к оформлению заказа в зависимости от содержимого корзины.
  - set total(sum: number) - устанавливает текстовое содержимое с общей стоимость товаров в корзине. 

#### Form

Form — это компонент, который отвечает за отображение содержимого форм для оформления заказа. Этих форм две: в первой собираются данные от пользователя о методе оплаты и адресе доставки, во второй контактная информация. Базируется на классе Component и реализует его в контексте конкретного компонента интерфейса.

Поля:
  - _submit: HTMLButtonElement - кнопка отправки формы. 
  - _errors: HTMLElement - DOM-элемент для отображения ошибок в валидации.

Методы: 
  - onInputChange - обработчик события ввода в поле ввода. Возвращает название поля и введенное в него значение.
  - onButtonChange - обработчик клика по кнопкам с выбором метода оплаты. 
  - _handlePaymentButton - ручка переключения классов у выбранного метода оплаты. Кнопки имеют тип button, но реализованы как radio. 
  - valid(value: boolean) - метод, блокирующий кнопку отправки формы.
  - errors - устанавливает текстовое содержимое с ошибками валидации.
  - render(state: Partial<T> & IFormState): HTMLElement - реализует родительский метод для отрисовки полей ввода, ошибок и возможности валидации.

#### Order 

Order наследует класс Form и через него реализует метод render, который был описан выше. В проекте используется конструктор именно из Order. Его собственный методы в проекте не используются, но предусмотрены на случай, если необходимо будет подставлять содержимое в поля намеренно, например, из local storage. 

#### Success

Success - компонент уведомляет пользователя об успешном оформлении заказа. Базируется на классе Component и реализует его в контексте конкретного компонента интерфейса.

Поля:
  - _close: HTMLElement - кнопка выхода из заказа, закрывает окно об успешном оформлении заказа.
  - _desc: HTMLElement - текстовый элемент, в котором пользователь видит сумму своего заказа. 

Методы: 
  - setDescription(total: number): void - устанавливает текстовое содержимое в поле _desc. 

Здесь пользовательский путь завершается. Пользователь видит окно об успешном оформлении заказа только после успешной валидации всех форм и успешной отправки заказа на сервер посредством АПИ. Окна с ошибкой пока не предусмотрено.

#### Card

Класс Card представляет визуальный компонент карточки товара и управляет её содержимым: заголовком, категорией, изображением, описанием, ценой и кнопкой добавления в корзину. Обеспечивает создание и настройку карточки товара на основе входных данных. Позволяет динамически изменять содержимое карточки, визуально выделять её по категории, а также управлять доступностью кнопки добавления в корзину. Инициализируется с указанием CSS-блока (BEM), к которому относится карточка. Базируется на классе Component и реализует его в контексте конкретного компонента интерфейса.

Поля: 
  - _category: HTMLElement - категория товара. Обязательное поле. т.к. по логике интернет-магазина товар всегда принадлежит к какой-то категории.
  - _title: HTMLElement - название товара. Обязательное поле, т.к. товар не модет быть безымянным.
  - _price: HTMLElement - цена товара. Обязательное поле, тоже следует из логики интернет-магазинов.
  - _image?: HTMLImageElemen - изображение товара. Опциональное поле предусмотрено на случай, если картинка с товаром не придет с сервера или намеренно скрыта(поставлена заглушка).
  - _description?: HTMLElement - описание товара. Опциональное поле, потому что не у каждого товара может быть описание, или его еще не придумали. 
  - _button: HTMLButtonElement - кнопка добавления товара в корзину.

Методы:
  - set id(value: string) - устанавливает data-атрибут с идентификатором товара. 
  - get id(): string - позволяет получить идентификатор товара.
  - set title(value: string) - реализует родительский метод setText, устанавливает текстовое содержимое с названием товара.
  - get title(): string - позволяет получить название товара.
  - set image(value: string) - реализует родительский метод setImage, устанавливает изоббражение товара и alt-атрибут. 
  - set category(value: string)  - устанавливает название категории товара.
  - set price(value: number | null) - устанавливает цену товара. Предусматривает вариант, если цена с сервера намеренно приходит как отсутствующая(например, товар out of stock или бесценен, как в нашем случае). Делает кнопку добавления товара в корзину недоступной, если цена равна null. 
  - set description(value: string) - устанавливает описание товара.
  - applyCategoryClass(category: Category): void - позволяет установить для соответствующей категории товара соответствующий класс стилей для бейджа. 
  - get priceNumber(): number - позволяет получить цену товара. 
  - get button(): HTMLButtonElement  - позволяет получить кнопку для добавления товара в корзину.
  - disableButton(value: boolean): void - управляет поведением кнопки добавления в корзину. Реализует родительский метод setDisabled. 


### Слой коммуникации

#### Класс LarekApi

Обёртка над Api. В конструктор передаётся экземпляр класса Api, предоставляются методы для работы с сервером.

## Взаимодействие компонентов

Файл `index.ts` выполняет роль презентера, управляя связью между слоями через брокер событий `EventEmitter`.  
Эмиссия событий в проекте реализована как во вью-слое, так и в модели данных: представление инициирует события пользовательских действий (например, клики по кнопкам), а модель — обновления состояния (например, изменения корзины). При этом вся подписка на события организована в `index.ts`, что упрощает отслеживание реакций на события, но может потребовать дальнейшей структуризации и разделения ответственности между слоями.

*Список событий:*
  - `items:changed` - изменение данных о товарах.
  - `modal:open` - открытие модального окна.
  - `modal:close` - закрытие модального окна.
  - `card:select` - подписка на событие открытия превью карточки.
  - `basket:open` - открытие корзины.
  - `basket:change` - изменение содержимого корзины.
  - `basket:delete` - удаление товара из корзины.
  - `formErrors:change` - изменения в формах при их валидации.
  - `order.payment:change` - изменение метода оплаты.
  - `${eventPrefix}.${String(field)}:change` - изменение в поле ввода. 
  - `/^order\.(address|payment):change/` - изменения в форме с выбором оплаты и адресом.
  - `/^contacts\.(email|phone):change/` - изменения в форме с контактами.
  - `order:first` - подписка на открытие первого этапа оформления заказа(метода оплаты и адреса).
  - `order:second` - подписка на событие открытия второго этапа заказа(контактов).
  - `order:submit` - отправка первой формы. 
  - `contacts:submit` - отправка второй формы.